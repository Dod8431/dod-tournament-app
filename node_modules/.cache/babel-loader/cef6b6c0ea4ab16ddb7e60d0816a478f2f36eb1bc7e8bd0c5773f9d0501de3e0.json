{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\doria\\\\dod-tournament-app\\\\src\\\\components\\\\VotingPanel.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { listenTournament, submitVote } from '../firebase/firestore';\nimport FaceOffPanel from './FaceOffPanel';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst themeClasses = {\n  classic: \"bg-gradient-to-br from-blue-100 to-indigo-200\",\n  retro: \"bg-yellow-200 text-pink-700 font-mono\",\n  meme: \"bg-green-200 text-purple-900 font-bold\",\n  dark: \"bg-gray-900 text-white\",\n  light: \"bg-white text-black\"\n};\nfunction VotingPanel() {\n  _s();\n  var _tournament$videos, _tournament$videos$fi, _tournament$videos2, _tournament$videos2$f;\n  const {\n    tid\n  } = useParams();\n  const [tournament, setTournament] = useState(null);\n  const [matches, setMatches] = useState([]);\n  const [currentIdx, setCurrentIdx] = useState(0);\n  const [selected, setSelected] = useState({});\n  const [voted, setVoted] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n  const navigate = useNavigate();\n  const hasRedirected = useRef(false);\n\n  // Defensive user fetch\n  let user = null;\n  try {\n    user = JSON.parse(localStorage.getItem(`tourn_${tid}_user`));\n  } catch (e) {\n    user = null;\n  }\n  useEffect(() => {\n    if (!user) {\n      if (!hasRedirected.current) {\n        hasRedirected.current = true;\n        navigate(`/tournament/${tid}/join`);\n      }\n      return;\n    }\n    const unsub = listenTournament(tid, data => {\n      var _data$bracket, _data$bracket$find;\n      setTournament(data);\n      setLoading(false);\n      const round = data.currentRound;\n      const rBracket = (_data$bracket = data.bracket) === null || _data$bracket === void 0 ? void 0 : (_data$bracket$find = _data$bracket.find) === null || _data$bracket$find === void 0 ? void 0 : _data$bracket$find.call(_data$bracket, r => r.round === round);\n      setMatches(rBracket ? rBracket.matches : []);\n    });\n    return () => unsub && unsub();\n    // eslint-disable-next-line\n  }, [tid]);\n  const handleReveal = (idx, side) => {\n    setSelected(prev => ({\n      ...prev,\n      [`${idx}_${side}_revealed`]: true\n    }));\n  };\n  const handleVote = async (match, voteFor) => {\n    if (!match || !user) return;\n    await submitVote(tid, user.userId, tournament.currentRound, match.id, voteFor);\n    setSelected(prev => ({\n      ...prev,\n      [match.id]: voteFor\n    }));\n    if (currentIdx < matches.length - 1) {\n      setCurrentIdx(currentIdx + 1);\n    } else {\n      setVoted(true);\n    }\n  };\n\n  // BLANK/LOADING states\n  if (loading || !tournament) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex justify-center items-center min-h-screen\",\n    children: \"Loading...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 38\n  }, this);\n  if (!user) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex justify-center items-center min-h-screen text-red-700\",\n    children: \"User not found. Please join tournament.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 21\n  }, this);\n  if (!Array.isArray(matches) || matches.length === 0) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-center items-center min-h-screen text-lg\",\n      children: \"No matches available for voting in this round.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Recap state\n  const votedRef = useRef(false);\n  if (voted && !votedRef.current) {\n    votedRef.current = true;\n    setTimeout(() => navigate(`/tournament/${tid}/recap`), 1200);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-center items-center min-h-screen text-2xl font-bold\",\n      children: \"Round submitted! Loading recap...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Defensive: handle match\n  const match = matches[currentIdx];\n  if (!match) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex justify-center items-center min-h-screen text-red-600\",\n    children: \"No match data\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 22\n  }, this);\n  const videoA = (_tournament$videos = tournament.videos) === null || _tournament$videos === void 0 ? void 0 : (_tournament$videos$fi = _tournament$videos.find) === null || _tournament$videos$fi === void 0 ? void 0 : _tournament$videos$fi.call(_tournament$videos, v => v.id === match.videoAId);\n  const videoB = (_tournament$videos2 = tournament.videos) === null || _tournament$videos2 === void 0 ? void 0 : (_tournament$videos2$f = _tournament$videos2.find) === null || _tournament$videos2$f === void 0 ? void 0 : _tournament$videos2$f.call(_tournament$videos2, v => v.id === match.videoBId);\n  if (!videoA || !videoB) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-center items-center min-h-screen text-red-600\",\n      children: \"Video data missing\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(FaceOffPanel, {\n    videoA: videoA,\n    videoB: videoB,\n    revealedA: !!selected[`${currentIdx}_A_revealed`],\n    revealedB: !!selected[`${currentIdx}_B_revealed`],\n    onRevealA: () => handleReveal(currentIdx, 'A'),\n    onRevealB: () => handleReveal(currentIdx, 'B'),\n    onVote: id => handleVote(match, id)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n}\n_s(VotingPanel, \"MxzW+QDU4fElk1Uz+aVxuM7acPs=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = VotingPanel;\nexport default VotingPanel;\nvar _c;\n$RefreshReg$(_c, \"VotingPanel\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","listenTournament","submitVote","FaceOffPanel","jsxDEV","_jsxDEV","themeClasses","classic","retro","meme","dark","light","VotingPanel","_s","_tournament$videos","_tournament$videos$fi","_tournament$videos2","_tournament$videos2$f","tid","tournament","setTournament","matches","setMatches","currentIdx","setCurrentIdx","selected","setSelected","voted","setVoted","loading","setLoading","error","setError","navigate","hasRedirected","user","JSON","parse","localStorage","getItem","e","current","unsub","data","_data$bracket","_data$bracket$find","round","currentRound","rBracket","bracket","find","call","r","handleReveal","idx","side","prev","handleVote","match","voteFor","userId","id","length","className","children","fileName","_jsxFileName","lineNumber","columnNumber","Array","isArray","votedRef","setTimeout","videoA","videos","v","videoAId","videoB","videoBId","revealedA","revealedB","onRevealA","onRevealB","onVote","_c","$RefreshReg$"],"sources":["C:/Users/doria/dod-tournament-app/src/components/VotingPanel.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { listenTournament, submitVote } from '../firebase/firestore';\r\nimport FaceOffPanel from './FaceOffPanel';\r\n\r\nconst themeClasses = {\r\n  classic: \"bg-gradient-to-br from-blue-100 to-indigo-200\",\r\n  retro: \"bg-yellow-200 text-pink-700 font-mono\",\r\n  meme: \"bg-green-200 text-purple-900 font-bold\",\r\n  dark: \"bg-gray-900 text-white\",\r\n  light: \"bg-white text-black\"\r\n};\r\n\r\nfunction VotingPanel() {\r\n  const { tid } = useParams();\r\n  const [tournament, setTournament] = useState(null);\r\n  const [matches, setMatches] = useState([]);\r\n  const [currentIdx, setCurrentIdx] = useState(0);\r\n  const [selected, setSelected] = useState({});\r\n  const [voted, setVoted] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n  const navigate = useNavigate();\r\n  const hasRedirected = useRef(false);\r\n\r\n  // Defensive user fetch\r\n  let user = null;\r\n  try {\r\n    user = JSON.parse(localStorage.getItem(`tourn_${tid}_user`));\r\n  } catch (e) {\r\n    user = null;\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!user) {\r\n      if (!hasRedirected.current) {\r\n        hasRedirected.current = true;\r\n        navigate(`/tournament/${tid}/join`);\r\n      }\r\n      return;\r\n    }\r\n    const unsub = listenTournament(tid, (data) => {\r\n      setTournament(data);\r\n      setLoading(false);\r\n      const round = data.currentRound;\r\n      const rBracket = data.bracket?.find?.(r => r.round === round);\r\n      setMatches(rBracket ? rBracket.matches : []);\r\n    });\r\n    return () => unsub && unsub();\r\n    // eslint-disable-next-line\r\n  }, [tid]);\r\n\r\n  const handleReveal = (idx, side) => {\r\n    setSelected(prev => ({ ...prev, [`${idx}_${side}_revealed`]: true }));\r\n  };\r\n\r\n  const handleVote = async (match, voteFor) => {\r\n    if (!match || !user) return;\r\n    await submitVote(tid, user.userId, tournament.currentRound, match.id, voteFor);\r\n    setSelected(prev => ({ ...prev, [match.id]: voteFor }));\r\n    if (currentIdx < matches.length - 1) {\r\n      setCurrentIdx(currentIdx + 1);\r\n    } else {\r\n      setVoted(true);\r\n    }\r\n  };\r\n\r\n  // BLANK/LOADING states\r\n  if (loading || !tournament) return <div className=\"flex justify-center items-center min-h-screen\">Loading...</div>;\r\n  if (!user) return <div className=\"flex justify-center items-center min-h-screen text-red-700\">User not found. Please join tournament.</div>;\r\n\r\n  if (!Array.isArray(matches) || matches.length === 0) {\r\n    return <div className=\"flex justify-center items-center min-h-screen text-lg\">No matches available for voting in this round.</div>;\r\n  }\r\n\r\n  // Recap state\r\n  const votedRef = useRef(false);\r\n  if (voted && !votedRef.current) {\r\n    votedRef.current = true;\r\n    setTimeout(() => navigate(`/tournament/${tid}/recap`), 1200);\r\n    return <div className=\"flex justify-center items-center min-h-screen text-2xl font-bold\">Round submitted! Loading recap...</div>;\r\n  }\r\n\r\n  // Defensive: handle match\r\n  const match = matches[currentIdx];\r\n  if (!match) return <div className=\"flex justify-center items-center min-h-screen text-red-600\">No match data</div>;\r\n\r\n  const videoA = tournament.videos?.find?.(v => v.id === match.videoAId);\r\n  const videoB = tournament.videos?.find?.(v => v.id === match.videoBId);\r\n\r\n  if (!videoA || !videoB) {\r\n    return <div className=\"flex justify-center items-center min-h-screen text-red-600\">Video data missing</div>;\r\n  }\r\n\r\n  return (\r\n    <FaceOffPanel\r\n      videoA={videoA}\r\n      videoB={videoB}\r\n      revealedA={!!selected[`${currentIdx}_A_revealed`]}\r\n      revealedB={!!selected[`${currentIdx}_B_revealed`]}\r\n      onRevealA={() => handleReveal(currentIdx, 'A')}\r\n      onRevealB={() => handleReveal(currentIdx, 'B')}\r\n      onVote={id => handleVote(match, id)}\r\n    />\r\n  );\r\n}\r\n\r\nexport default VotingPanel;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}